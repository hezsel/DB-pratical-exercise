<%- include("../partials/_header") %>

<%- include("../partials/_openCard") %>

<form action="/consulta/confirm" method="POST">

  <input
    type="text"
    name="paciente"
    value="<%= paciente %>"
    style="display: none;"
  />
  <input
    type="text"
    name="profissional"
    value="<%= profissional %>"
    style="display: none;"
  />

  <h5 class="card-title">Escolha o horário:</h5>

  <input
    id="data-input"
    type="date"
    name="data"
    value="<%= data %>"
    class="form-control mb-2"
  />

  <div class="form-check my-4">
    <% if (slots) { %>
      <div class="mb-3">
        <h6>Disponiveis:</h6>
      </div>
      <div class="container">
        <div class="row">
          <% for(let i = 0; i < slots.length; i++) { %>
            <div class="col-3">
              <input
                class="form-check-input" 
                type="radio" 
                name="slot" 
                id="inlineRadio1"
                <% if (i === 0) { %> checked <% } %>
                value="<%= slots[i] %>"
              >
              <label 
                class="form-check-label" 
                for="inlineRadio1"
              >
                <%= slots[i] %>
              </label>
            </div>
          <% } %>
        </div>
      </div>
    <% } else { %>
      <option value="">Nenhum horário disponível nesse dia</option>
    <% } %>
  </div>

  <div class="d-flex flex-row-reverse mt-4">
    <button type="submit" class="btn btn-primary" <% if (!slots) { %> disabled <% } %> >
      Marcar Consulta 
    </button>
  </div>

</form>

<script>
  const input = document.querySelector('#data-input')

  input.addEventListener('change', function () {
    const date = new Date(this.value)
    if (
      date instanceof Date
      && !isNaN(date.valueOf())
      && this.value.length === 10
    ) {
      const baseUrl = window.location.href.split('?')[0]
      const newUrl = `${baseUrl}?paciente=<%= paciente %>&profissional=<%= profissional %>&data=${input.value}`
      window.location.href = newUrl
    }
  })
</script>

<%- include("../partials/_closeCard") %>
          
<%- include("../partials/_footer") %>
